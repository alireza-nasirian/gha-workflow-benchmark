--- .github/workflows/CI.yml@7f9326123dd286e8232c58eed4a3db3c6362452c
+++ .github/workflows/CI.yml@edb4239df483469c5b6b12ad366ad7dce290c1d7
@@ -1,4 +1,4 @@
-# This file is autogenerated by maturin v1.4.0
+# This file is autogenerated by maturin v1.7.8
 # To update, run
 #
 #    maturin generate-ci github
@@ -20,127 +20,167 @@
 
 jobs:
   linux:
-    runs-on: ubuntu-latest
-    strategy:
-      matrix:
-        # target: [x86_64, x86, aarch64, armv7, s390x, ppc64le]
-        target: [x86_64, x86]
-    steps:
-      - uses: actions/checkout@v4
-      - uses: actions/setup-python@v5
-        with:
-          python-version: '3.10'
-      - name: Build wheels
-        uses: PyO3/maturin-action@v1
-        with:
-          target: ${{ matrix.target }}
-          args: --release --out dist --find-interpreter
+    runs-on: ${{ matrix.platform.runner }}
+    strategy:
+      matrix:
+        platform:
+          - runner: ubuntu-22.04
+            target: x86_64
+          - runner: ubuntu-22.04
+            target: x86
+          - runner: ubuntu-22.04
+            target: aarch64
+          - runner: ubuntu-22.04
+            target: armv7
+            # - runner: ubuntu-22.04
+            #   target: s390x
+          - runner: ubuntu-22.04
+            target: ppc64le
+    steps:
+      - uses: actions/checkout@v4
+      - uses: actions/setup-python@v5
+        with:
+          python-version: 3.x
+      - name: Build wheels
+        uses: PyO3/maturin-action@v1
+        with:
+          target: ${{ matrix.platform.target }}
+          args: --release --out dist
           sccache: 'true'
           manylinux: auto
-          before-script-linux: "yum install openssl-devel devtoolset-10-libatomic-devel perl-IPC-Cmd -y"
-      - name: Upload wheels
-        uses: actions/upload-artifact@v4
-        with:
-          name: "wheels-linux-${{ matrix.target }}"
-          path: dist
-
-  linux2:
-    runs-on: ubuntu-latest
-    strategy:
-      matrix:
-        # target: [x86_64, x86, aarch64, armv7, s390x, ppc64le]
-        target: [aarch64, armv7, ppc64le]
-    steps:
-      - uses: actions/checkout@v4
-      - uses: actions/setup-python@v5
-        with:
-          python-version: '3.10'
-      - name: Build wheels
-        uses: PyO3/maturin-action@v1
-        with:
-          target: ${{ matrix.target }}
-          args: --release --out dist -i python3.7 -i python3.8 -i python3.9 -i python3.10 -i python3.11 -i python3.12 
+          before-script-linux: |
+            if command -v apt-get &> /dev/null; then
+                apt-get update && apt-get install libssl-dev libatomic-ops-dev -y
+            elif command -v yum &> /dev/null; then
+                yum install openssl-devel devtoolset-10-libatomic-devel perl-IPC-Cmd -y
+            else
+                echo "Neither apt-get nor yum is installed. Please install a package manager."
+                exit 1
+            fi
+      - name: Build free-threaded wheels
+        uses: PyO3/maturin-action@v1
+        with:
+          target: ${{ matrix.platform.target }}
+          args: --release --out dist -i python3.13t
           sccache: 'true'
           manylinux: auto
-          before-script-linux: "apt-get update && apt-get install libssl-dev -y"
-      - name: Upload wheels
-        uses: actions/upload-artifact@v4
-        with:
-          name: "wheels-linux2-${{ matrix.target }}"
+          before-script-linux: |
+            if command -v apt-get &> /dev/null; then
+                apt-get update && apt-get install libssl-dev libatomic-ops-dev -y
+            elif command -v yum &> /dev/null; then
+                yum install openssl-devel devtoolset-10-libatomic-devel perl-IPC-Cmd -y
+            else
+                echo "Neither apt-get nor yum is installed. Please install a package manager."
+                exit 1
+            fi
+      - name: Upload wheels
+        uses: actions/upload-artifact@v4
+        with:
+          name: wheels-linux-${{ matrix.platform.target }}
+          path: dist
+
+  musllinux:
+    runs-on: ${{ matrix.platform.runner }}
+    strategy:
+      matrix:
+        platform:
+          - runner: ubuntu-22.04
+            target: x86_64
+          - runner: ubuntu-22.04
+            target: x86
+          - runner: ubuntu-22.04
+            target: aarch64
+          - runner: ubuntu-22.04
+            target: armv7
+    steps:
+      - uses: actions/checkout@v4
+      - uses: actions/setup-python@v5
+        with:
+          python-version: 3.x
+      - name: Build wheels
+        uses: PyO3/maturin-action@v1
+        with:
+          target: ${{ matrix.platform.target }}
+          args: --release --out dist
+          sccache: 'true'
+          manylinux: musllinux_1_2
+      - name: Build free-threaded wheels
+        uses: PyO3/maturin-action@v1
+        with:
+          target: ${{ matrix.platform.target }}
+          args: --release --out dist -i python3.13t
+          sccache: 'true'
+          manylinux: musllinux_1_2
+      - name: Upload wheels
+        uses: actions/upload-artifact@v4
+        with:
+          name: wheels-musllinux-${{ matrix.platform.target }}
           path: dist
 
   windows:
-    runs-on: windows-latest
-    strategy:
-      matrix:
-        target: [x64, x86]
-    steps:
-      - uses: actions/checkout@v4
-      - uses: actions/setup-python@v5
-        with:
-          python-version: '3.10'
-          architecture: ${{ matrix.target }}
-      - name: Build wheels
-        uses: PyO3/maturin-action@v1
-        with:
-          target: ${{ matrix.target }}
-          args: --release --out dist --find-interpreter
-          sccache: 'true'
-      - name: Upload wheels
-        uses: actions/upload-artifact@v4
-        with:
-          name: "wheels-windows-${{ matrix.target }}"
+    runs-on: ${{ matrix.platform.runner }}
+    strategy:
+      matrix:
+        platform:
+          - runner: windows-latest
+            target: x64
+          - runner: windows-latest
+            target: x86
+    steps:
+      - uses: actions/checkout@v4
+      - uses: actions/setup-python@v5
+        with:
+          python-version: 3.x
+          architecture: ${{ matrix.platform.target }}
+      - name: Build wheels
+        uses: PyO3/maturin-action@v1
+        with:
+          target: ${{ matrix.platform.target }}
+          args: --release --out dist
+          sccache: 'true'
+          # - name: Build free-threaded wheels
+          #   uses: PyO3/maturin-action@v1
+          #   with:
+          #     target: ${{ matrix.platform.target }}
+          #     args: --release --out dist -i python3.13t
+          #     sccache: 'true'
+      - name: Upload wheels
+        uses: actions/upload-artifact@v4
+        with:
+          name: wheels-windows-${{ matrix.platform.target }}
           path: dist
 
   macos:
-    runs-on: macos-latest
-    strategy:
-      matrix:
-        target: [x86_64, aarch64]
-    steps:
-      - uses: actions/checkout@v4
-      - uses: actions/setup-python@v5
-        with:
-          python-version: '3.10'
-      - name: Build wheels
-        uses: PyO3/maturin-action@v1
-        with:
-          target: ${{ matrix.target }}
-          args: --release --out dist --find-interpreter
-          sccache: 'true'
-      - name: Upload wheels
-        uses: actions/upload-artifact@v4
-        with:
-          name: "wheels-macos-${{ matrix.target }}"
-          path: dist
-
-  tests:
-    runs-on: ubuntu-latest
-    steps:
-      - uses: actions/checkout@v4
-      - uses: actions/checkout@v4
-        with:
-          repository: huggingface/huggingface_hub
-          path: huggingface_hub
-      - uses: actions/setup-python@v5
-        with:
-          python-version: '3.10'
-      - name: Create venv
-        run: python3 -m venv .venv
-      - name: Build wheels
-        uses: PyO3/maturin-action@v1
-        with:
-          command: develop
-          sccache: 'true'
-      - name: Install huggingface_hub dependencies
-        run: |
-          source .venv/bin/activate
-          python3 -m pip install -e 'huggingface_hub[testing]'
-      - name: Run tests
-        run: |
-          source .venv/bin/activate
-          HF_HUB_ENABLE_HF_TRANSFER=1 pytest huggingface_hub/tests/test_file_download.py
-          HF_HUB_ENABLE_HF_TRANSFER=1 pytest huggingface_hub/tests/test_hf_api.py -k 'test_upload_lfs_file_multipart'
+    runs-on: ${{ matrix.platform.runner }}
+    strategy:
+      matrix:
+        platform:
+          - runner: macos-13
+            target: x86_64
+          - runner: macos-14
+            target: aarch64
+    steps:
+      - uses: actions/checkout@v4
+      - uses: actions/setup-python@v5
+        with:
+          python-version: 3.x
+      - name: Build wheels
+        uses: PyO3/maturin-action@v1
+        with:
+          target: ${{ matrix.platform.target }}
+          args: --release --out dist
+          sccache: 'true'
+      - name: Build free-threaded wheels
+        uses: PyO3/maturin-action@v1
+        with:
+          target: ${{ matrix.platform.target }}
+          args: --release --out dist -i python3.13t
+          sccache: 'true'
+      - name: Upload wheels
+        uses: actions/upload-artifact@v4
+        with:
+          name: wheels-macos-${{ matrix.platform.target }}
+          path: dist
 
   sdist:
     runs-on: ubuntu-latest
@@ -160,53 +200,26 @@
   release:
     name: Release
     runs-on: ubuntu-latest
-    if: "startsWith(github.ref, 'refs/tags/')"
-    needs: [linux, windows, macos, sdist]
+    if: ${{ startsWith(github.ref, 'refs/tags/') || github.event_name == 'workflow_dispatch' }}
+    needs: [linux, musllinux, windows, macos, sdist]
+    permissions:
+      # Use to sign the release artifacts
+      id-token: write
+      # Used to upload release artifacts
+      contents: write
+      # Used to generate artifact attestation
+      attestations: write
     steps:
       - uses: actions/download-artifact@v4
-        name: download linux x86_64 artifacts
-        with:
-          name: wheels-linux-x86_64
-      - uses: actions/download-artifact@v4
-        name: download linux x86 artifacts
-        with:
-          name: wheels-linux-x86
-      - uses: actions/download-artifact@v4
-        name: download linux2 aarch64 artifacts
-        with:
-          name: wheels-linux2-aarch64
-      - uses: actions/download-artifact@v4
-        name: download linux2 armv7 artifacts
-        with:
-          name: wheels-linux2-armv7
-      - uses: actions/download-artifact@v4
-        name: download linux2 ppc64le artifacts
-        with:
-          name: wheels-linux2-ppc64le
-      - uses: actions/download-artifact@v4
-        name: download macos x86_64 artifacts
-        with:
-          name: wheels-macos-x86_64
-      - uses: actions/download-artifact@v4
-        name: download macos aarch64 artifacts
-        with:
-          name: wheels-macos-aarch64
-      - uses: actions/download-artifact@v4
-        name: download windows x64 artifacts
-        with:
-          name: wheels-windows-x64
-      - uses: actions/download-artifact@v4
-        name: download windows x86 artifacts
-        with:
-          name: wheels-windows-x86
-      - uses: actions/download-artifact@v4
-        name: download sdist artifacts
-        with:
-          name: wheels-sdist
+      - name: Generate artifact attestation
+        uses: actions/attest-build-provenance@v1
+        with:
+          subject-path: 'wheels-*/*'
       - name: Publish to PyPI
+        if: ${{ startsWith(github.ref, 'refs/tags/') }}
         uses: PyO3/maturin-action@v1
         env:
           MATURIN_PYPI_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
         with:
           command: upload
-          args: --non-interactive --skip-existing *
+          args: --non-interactive --skip-existing wheels-*/*
